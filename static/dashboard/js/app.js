// Generated by CoffeeScript 1.6.1
(function() {
  define([ "jquery", "underscore", "backbone", "router", "models/ConfigModel", "models/AtAGlanceModel", "views/SidebarView", "views/ContentView", "text!templates/overview.html", "text!templates/sidebar.html", "views/chartView", "models/ChartModel", "highcharts" ], function(e, t, n, r, i, s, o, u, a, f, l, c, h) {
    return {
      events: {
        "click a": "pushstateClick",
        "click li": "pushstateClick"
      },
      pushstateClick: function(e) {
        return e.preventDefault();
      },
      initialize: function() {
        var n, c, h = this;
        r.initialize();
        e("#server_on").on("click", function() {
          return e("#server_status").css({
            color: "yellow"
          });
        });
        e(function() {
          var t;
          t = io.connect("/server_status");
          t.on("connect", function() {
            return e.ajax({
              url: "/monitor_server"
            });
          });
          return t.on("status", function(t) {
            if (parseInt(t) === 0) {
              e("#server_status").css({
                color: "green"
              });
              e("#server_on").css({
                color: "grey"
              });
              e("#server_off").css({
                color: "orange"
              });
              return e("#run").css({
                color: "orange"
              });
            }
            e("#server_status").css({
              color: "red"
            });
            e("#server_off").css({
              color: "grey"
            });
            return e("#server_on").css({
              color: "orange"
            });
          });
        });
        this.ataglance = new s;
        n = this.ataglance.fetch();
        n.done(function() {
          var n;
          h.config = new i;
          n = h.config.fetch();
          return n.done(function() {
            var n, r, i, s;
            r = t.template(a, {
              input: {
                balance: h.ataglance.get("balance"),
                debug: h.config.get("Server Parameters").debug === "True" ? "checked" : "",
                using_sandbox: h.config.get("HIT Configuration").using_sandbox === "True" ? "checked" : ""
              }
            });
            e("#content").html(r);
            n = new l;
            n.initialize();
            n.setChart();
            i = t.template(f);
            e("#sidebar").html(i);
            s = new o({
              config: h.config,
              ataglance: h.ataglance,
              chart: n
            });
            return s.initialize();
          });
        });
        c = new u;
        c.initialize();
        e("#run").on("click", function() {
          e("#run-expt-modal").modal("show");
          return e("#crate-hit-btn").on("click", function() {
            return e.ajax({
              url: "/create_hit"
            });
          });
        });
        e("#server_off").on("click", function() {
          e("#server-off-modal").modal("show");
          return e("#shutdownServerBtn").on("click", function() {
            e("#server_status").css({
              color: "yellow"
            });
            return e.ajax({
              url: "/shutdown",
              type: "GET",
              success: e("#server-off-modal").modal("hide")
            });
          });
        });
        return e("#server_on").on("click", function() {
          return e.ajax({
            url: "/launch",
            type: "GET",
            success: e(function() {
              var t;
              t = io.connect("/server_status");
              t.on("connect", function() {
                return e.ajax({
                  url: "/monitor_server"
                });
              });
              return t.on("status", function(t) {
                if (parseInt(t) === 0) {
                  e("#server_status").css({
                    color: "green"
                  });
                  e("#server_on").css({
                    color: "grey"
                  });
                  e("#server_off").css({
                    color: "orange"
                  });
                  return e("#run").css({
                    color: "orange"
                  });
                }
                e("#server_status").css({
                  color: "red"
                });
                e("#server_off").css({
                  color: "grey"
                });
                return e("#server_on").css({
                  color: "orange"
                });
              });
            })
          });
        });
      }
    };
  });
}).call(this);